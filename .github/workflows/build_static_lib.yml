name: Build static library for QuickJS

# on:
#     pull_request:
#         types:
#         - opened
#         branches:
#         - 'dependabot/submodules/deps/quickjs-*'

on:
    workflow_dispatch:

jobs:
    linux-x86_64:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
              with:
                  submodules: true
                  fetch-depth: 1
            - uses: jirutka/setup-alpine@v1
              with:
                  arch: x86_64
                  packages: "build-base make cmake"
            - name: build
              shell: alpine.sh {0}
              run: |
                cd deps/quickjs
                make clean
                make -e CONFIG_LTO=y libquickjs.a
                mv libquickjs.a ../libs/linux_amd64

            - name: Create PR For Linux x86_64
              uses: peter-evans/create-pull-request@v6
              with:
                  commit-message: Update QuickJS Static Library For Linux x86_64
                  branch-suffix: random
                  delete-branch: true
                  title: Update QuickJS Static library For Linux x86_64
